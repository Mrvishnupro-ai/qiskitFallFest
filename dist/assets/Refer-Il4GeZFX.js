import{c as F,r as d,u as z,w as H,z as c,j as e,m as k,B as y}from"./index-BndXp_on.js";import{L as E,I as S}from"./label-BHPy6-3u.js";import{C as x,b as u,c as h,a as p}from"./card-CCgJlzPZ.js";import{U as O}from"./users-wUUefqdo.js";import{T as Q}from"./trophy-CUuG3-iQ.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=F("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j=F("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),X=()=>{const[f,L]=d.useState(""),[N,T]=d.useState([]),[U,I]=d.useState(!0),[m,b]=d.useState(""),[g,v]=d.useState(!1),[q,A]=d.useState(""),[w,Y]=d.useState([]),{user:s}=z(),{toast:i}=H();d.useEffect(()=>{s&&(C(),B())},[s]);const C=async()=>{try{const{data:r,error:t}=await c.from("registrations").select(`
          referral_code,
          id,
          referred_by,
          referrer:registrations!referred_by(referral_code)
        `).eq("user_id",s.id).single();if(t&&t.code!=="PGRST116")throw t;if(r){v(!0),L(r.referral_code),r.referrer&&r.referrer.referral_code&&(A(r.referrer.referral_code),b(r.referrer.referral_code));const{data:a,error:l}=await c.from("registrations").select("fullName, email, created_at").eq("referred_by",r.id);if(l)throw l;T(a||[])}else v(!1)}catch(r){console.error("Error fetching referral data:",r),i({title:"Error",description:"Failed to load referral data.",variant:"destructive"})}finally{I(!1)}},B=async()=>{try{const{data:r,error:t}=await c.from("registrations").select(`
          referred_by,
          referrer:registrations!referred_by(fullName, email)
        `).not("referred_by","is",null);if(t)throw t;const a={};r.forEach(o=>{var R,_;const n=o.referred_by;a[n]||(a[n]={id:n,count:0,fullName:((R=o.referrer)==null?void 0:R.fullName)||"Unknown",email:((_=o.referrer)==null?void 0:_.email)||"Unknown"}),a[n].count++});const l=Object.values(a).sort((o,n)=>n.count-o.count).slice(0,5);Y(l)}catch(r){console.error("Error fetching leaderboard:",r)}},D=()=>{navigator.clipboard.writeText(f),i({title:"Copied!",description:"Referral code copied to clipboard."})},P=()=>{const r=`${window.location.origin}/register?ref=${f}`;navigator.share?navigator.share({title:"Join Qiskit Fall Fest 2025",text:"Use my referral code to register!",url:r}):(navigator.clipboard.writeText(r),i({title:"Link Copied!",description:"Referral link copied to clipboard."}))},$=async()=>{var r;if(!m.trim()){i({title:"Error",description:"Please enter a referral code.",variant:"destructive"});return}if(m.trim()===f){i({title:"Invalid Code",description:"You cannot use your own referral code.",variant:"destructive"});return}try{let t=null;const{data:a}=await c.from("registrations").select("id, user_id").eq("referral_code",m.trim()).single();if(a){if(a.user_id===s.id){i({title:"Invalid Code",description:"You cannot use your own referral code.",variant:"destructive"});return}t=a.id}else{i({title:"Invalid Code",description:"The referral code you entered is invalid.",variant:"destructive"});return}if(g){const{error:l}=await c.from("registrations").update({referred_by:t}).eq("user_id",s.id);if(l)throw l}else{const l=btoa(s.id).substring(0,8),{error:o}=await c.from("registrations").insert([{user_id:s.id,fullName:((r=s.user_metadata)==null?void 0:r.full_name)||s.email,email:s.email,referral_code:l,referred_by:t}]);if(o)throw o}i({title:"Referral Applied!",description:"Your referral code has been applied successfully."}),C()}catch(t){console.error("Error applying referral code:",t),i({title:"Error",description:"Failed to apply referral code. Please try again.",variant:"destructive"})}};return U?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{children:"Loading..."})]})}):e.jsx(k.div,{initial:{opacity:0},animate:{opacity:1},className:"min-h-screen bg-background py-20",children:e.jsx("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs(k.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.8},className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h1",{className:"text-4xl lg:text-5xl font-bold font-poppins mb-4",children:"Refer & Earn"}),e.jsx("p",{className:"text-lg text-muted-foreground",children:"Share your referral code and invite friends to join Qiskit Fall Fest 2025"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-12",children:[e.jsxs(x,{className:"glass-card border border-white/10",children:[e.jsx(u,{children:e.jsxs(h,{className:"flex items-center",children:[e.jsx(j,{className:"h-5 w-5 mr-2 text-primary"}),"Friend's Referral Code"]})}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(E,{htmlFor:"friendReferralCode",children:"Referral Code"}),e.jsx(S,{id:"friendReferralCode",type:"text",value:m,onChange:r=>b(r.target.value),placeholder:"Enter your friend's referral code",className:"font-mono"})]}),e.jsx(y,{onClick:$,className:"w-full",children:"Apply/Update Referral Code"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:q?"Update your friend's referral code if needed.":"Enter a referral code from a friend to earn rewards!"})]})]}),e.jsxs(x,{className:"glass-card border border-white/10",children:[e.jsx(u,{children:e.jsxs(h,{className:"flex items-center",children:[e.jsx(j,{className:"h-5 w-5 mr-2 text-primary"}),"Your Referral Code"]})}),e.jsx(p,{className:"space-y-4",children:g?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(E,{children:"Referral Code"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(S,{value:f,readOnly:!0,className:"font-mono"}),e.jsx(y,{onClick:D,variant:"outline",children:e.jsx(G,{className:"h-4 w-4"})})]})]}),e.jsxs(y,{onClick:P,className:"w-full",children:[e.jsx(j,{className:"h-4 w-4 mr-2"}),"Share Referral Link"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Share this code with friends during registration to earn rewards!"})]}):e.jsx("p",{className:"text-muted-foreground",children:"Apply a friend's referral code first to get your own referral code."})})]}),e.jsxs(x,{className:"glass-card border border-white/10",children:[e.jsx(u,{children:e.jsxs(h,{className:"flex items-center",children:[e.jsx(O,{className:"h-5 w-5 mr-2 text-primary"}),"People You've Referred"]})}),e.jsx(p,{children:g?N.length===0?e.jsx("p",{className:"text-muted-foreground",children:"No referrals yet. Start sharing!"}):e.jsx("div",{className:"space-y-3",children:N.map((r,t)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:r.fullName}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r.email})]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:new Date(r.created_at).toLocaleDateString()})]},t))}):e.jsx("p",{className:"text-muted-foreground",children:"Apply a friend's referral code to start referring others."})})]})]}),e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs(x,{className:"glass-card border border-white/10",children:[e.jsx(u,{children:e.jsxs(h,{className:"flex items-center justify-center",children:[e.jsx(Q,{className:"h-6 w-6 mr-3 text-primary"}),"Top Referrers Leaderboard"]})}),e.jsx(p,{children:w.length===0?e.jsx("p",{className:"text-muted-foreground text-center",children:"No referrals yet. Be the first!"}):e.jsx("div",{className:"space-y-4",children:w.map((r,t)=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/50 rounded-lg hover:bg-muted/70 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:`text-2xl font-bold min-w-[40px] ${t===0?"text-yellow-500":t===1?"text-gray-400":t===2?"text-amber-600":"text-muted-foreground"}`,children:["#",t+1]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-lg",children:r.fullName}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r.email})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-lg font-bold text-primary",children:r.count}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["referral",r.count!==1?"s":""]})]})]},r.id))})})]})})]})})})};export{X as default};
